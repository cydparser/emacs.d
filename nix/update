#! /usr/bin/env nix-shell
#! nix-shell -i bash -p cabal2nix nix nix-prefetch-github
# Local Variables:
# mode: sh
# End:
set -e

cd "$(dirname "$0")"/..

if [[ "$#" -gt 0 ]]; then
  packages=( "$@" )
else
  packages=( dhall hies jdt-language-server nix-linter )
fi

for p in "${packages[@]}"; do
  case "$p" in
    dhall)
      cabal2nix cabal://dhall > nix/dhall.nix ;;
    jdt-language-server)
      _url="https://download.eclipse.org/jdtls/snapshots/$(curl --fail https://download.eclipse.org/jdtls/snapshots/latest.txt)"
      _sha="$(nix-prefetch-url "$_url")"
      echo "{ \"url\": \"$_url\", \"sha256\": \"$_sha\" }" > nix/jdt-language-server.json
      ;;
    *)
      echo "ERROR: Unknown package: $p" >&2
      exit 1
  esac
done
